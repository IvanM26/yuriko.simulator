[{"name":"server.R","content":"function(input, output, session) {\n\n  # Remove delay to show progress bar\n  options(cli.progress_show_after = 0)\n\n  decklist <- shiny::eventReactive(input$upload_decklist, {\n    \n    input_source_path <- switch (input$decklist_source,\n      moxfield_url = input$user_moxfield_url,\n      file = input$user_file$datapath\n    )\n    \n    process_card_data(\n      decklist_source = input$decklist_source,\n      source_path = input_source_path,\n      use_httr = FALSE # Change to TRUE in DEV\n    )\n\n  })\n  \n  output$table_decklist <- reactable::renderReactable({\n    decklist() |> \n      dplyr::select(card_name_scryfall) |> \n      reactable::reactable()\n  })\n  \n  shiny::observeEvent(decklist(), {\n    shiny::updateSelectInput(\n      session = session,\n      inputId = \"fixed_cards\",\n      choices = decklist()$card_name_scryfall,\n      selected = NULL\n    )\n  })\n\n  prob_from_decklist <- shiny::eventReactive(input$simulate_from_decklist, {\n    run_simulation(decklist(), fixed_cards = input$fixed_cards, n_sim = input$n_sim)\n  })\n  \n  simulation_summary_from_decklist_html <- shiny::eventReactive(prob_from_decklist(), {\n\n    prob_first_two_hands <- 1 - (1 - prob_from_decklist()) ^ 2\n    prob_first_three_hands <- 1 - (1 - prob_from_decklist()) ^ 3\n    prob_first_four_hands <- 1 - (1 - prob_from_decklist()) ^ 4\n    \n    shiny::div(\n      shiny::tags$ul(\n        shiny::tags$li(shiny::HTML(glue::glue(\"{ shiny::strong( scales::label_comma()(input$n_sim) ) } random 7-card hands were drawn from { shiny::strong('Your Decklist') }\"))),\n        if (!is.null(input$fixed_cards)) shiny::tags$li(shiny::HTML(glue::glue(\"The following cards were fixed to appear in all hands: { paste0(input$fixed_cards, collapse = ', ')}\"))),\n        shiny::tags$li(shiny::HTML(glue::glue(\"{ bold_percentage(prob_from_decklist()) } of the hands drawn had enough cards to trigger Yuriko on turn two\")))\n      ),\n      if (is.null(input$fixed_cards)) {\n        shiny::div(\n          \"Based on that value, it is expected that enough cards to trigger Yuriko on turn two will be present in:\",\n          shiny::tags$ul(\n            shiny::tags$li(shiny::HTML(glue::glue(\"one of the first two hands drawn in { bold_percentage(prob_first_two_hands) } of matches\"))),\n            shiny::tags$li(shiny::HTML(glue::glue(\"one of the first three hands drawn in { bold_percentage(prob_first_three_hands) }  of matches\"))),\n            shiny::tags$li(shiny::HTML(glue::glue(\"one of the first four hands drawn in { bold_percentage(prob_first_four_hands) }  of matches\"))),\n          ),\n          \"Then, assuming a \\\"free\\\" mulligan we can say that:\",\n          shiny::tags$ul(\n            shiny::tags$li(shiny::HTML(glue::glue(\"in { bold_percentage(prob_first_two_hands) } of matches a { shiny::strong('7-card') } hand will have enough cards to trigger Yuriko on turn two (i.e. considering at most one mulligan)\"))),\n            shiny::tags$li(shiny::HTML(glue::glue(\"in { bold_percentage(prob_first_three_hands) } of matches a hand with { shiny::strong('at least 6 cards') } will have enough cards to trigger Yuriko on turn two (i.e. considering at most two mulligans)\"))),\n            shiny::tags$li(shiny::HTML(glue::glue(\"in { bold_percentage(prob_first_four_hands) } of matches a hand with { shiny::strong('at least 5 cards') } will have enough cards to trigger Yuriko on turn two (i.e. considering at most three mulligans)\"))),\n          )\n        )\n        \n      }\n    )\n\n  })\n  \n  output$simulation_summary_from_decklist <- shiny::renderUI({\n    simulation_summary_from_decklist_html()\n  })\n\n  shiny::observeEvent(decklist(), {\n    shiny::updateSelectInput(session = session, inputId = \"card1\", choices = decklist()$card_name_scryfall, selected = decklist()$card_name_scryfall[[1]])\n    shiny::updateSelectInput(session = session, inputId = \"card2\", choices = decklist()$card_name_scryfall, selected = decklist()$card_name_scryfall[[2]])\n    shiny::updateSelectInput(session = session, inputId = \"card3\", choices = decklist()$card_name_scryfall, selected = decklist()$card_name_scryfall[[3]])\n    shiny::updateSelectInput(session = session, inputId = \"card4\", choices = decklist()$card_name_scryfall, selected = decklist()$card_name_scryfall[[4]])\n    shiny::updateSelectInput(session = session, inputId = \"card5\", choices = decklist()$card_name_scryfall, selected = decklist()$card_name_scryfall[[5]])\n    shiny::updateSelectInput(session = session, inputId = \"card6\", choices = decklist()$card_name_scryfall, selected = decklist()$card_name_scryfall[[6]])\n    shiny::updateSelectInput(session = session, inputId = \"card7\", choices = decklist()$card_name_scryfall, selected = decklist()$card_name_scryfall[[7]])\n  })\n  \n  shiny::observeEvent(input$random_hand, {\n    random_hand <- draw_seven(decklist())\n    shiny::updateSelectInput(session = session, inputId = \"card1\", selected = random_hand$card_name_scryfall[[1]])\n    shiny::updateSelectInput(session = session, inputId = \"card3\", selected = random_hand$card_name_scryfall[[2]])\n    shiny::updateSelectInput(session = session, inputId = \"card4\", selected = random_hand$card_name_scryfall[[3]])\n    shiny::updateSelectInput(session = session, inputId = \"card2\", selected = random_hand$card_name_scryfall[[4]])\n    shiny::updateSelectInput(session = session, inputId = \"card5\", selected = random_hand$card_name_scryfall[[5]])\n    shiny::updateSelectInput(session = session, inputId = \"card6\", selected = random_hand$card_name_scryfall[[6]])\n    shiny::updateSelectInput(session = session, inputId = \"card7\", selected = random_hand$card_name_scryfall[[7]])\n  })\n  \n  output$image1 <- render_card(decklist(), input, card_index = 1)\n  output$image2 <- render_card(decklist(), input, card_index = 2)\n  output$image3 <- render_card(decklist(), input, card_index = 3)\n  output$image4 <- render_card(decklist(), input, card_index = 4)\n  output$image5 <- render_card(decklist(), input, card_index = 5)\n  output$image6 <- render_card(decklist(), input, card_index = 6)\n  output$image7 <- render_card(decklist(), input, card_index = 7)\n  \n  test_hand <- shiny::reactive({\n    decklist() |> \n      dplyr::filter(card_name_scryfall %in% c(input$card1, input$card2, input$card3, input$card4, input$card5, input$card6, input$card7))\n  })\n  \n  output$test_hand_output <- shiny::renderUI({\n    if (is_yuriko_on_T2(test_hand())) {\n      shiny::div(\n        class = \"alert alert-success\",\n        \"Yuriko triggers on turn two\"\n      )\n    } else {\n      shiny::div(\n        class = \"alert alert-danger\",\n        \"Yuriko does not trigger on turn two\"\n      )\n    }\n  })\n  \n}","type":"text"},{"name":"ui.R","content":"shiny::tagList(\n  shiny::tags$head(\n    tags$link(rel = \"stylesheet\", type = \"text/css\", href = \"styles.css\")\n  ),\n  bslib::page_navbar(\n    title = \"Yuriko Simulator\",\n    bslib::nav_panel(\n      title = \"Your Decklist\",\n      bslib::layout_sidebar(\n        sidebar = bslib::sidebar(\n          width = 520,\n          title = \"Upload Decklist\",\n          shiny::selectInput(\n            inputId = \"decklist_source\",\n            label = \"Select Source\",\n            choices = c(\"Moxfield URL\" = \"moxfield_url\", \"File\" = \"file\")\n          ),\n          shiny::div(\n            shiny::conditionalPanel(\n              condition = \"input.decklist_source === 'moxfield_url'\",\n              shiny::textInput(\n                inputId = \"user_moxfield_url\",\n                label = \"Paste Moxfield URL\",\n                placeholder = \"Expected format: https://www.moxfield.com/decks/DECK_ID\",\n                width = \"100%\"\n              )\n            ),\n            shiny::conditionalPanel(\n              condition = \"input.decklist_source === 'file'\",\n              shiny::fileInput(\n                inputId = \"user_file\",\n                label = \"Select File\",\n                width = \"100%\"\n              )\n            )\n          ),\n          shiny::actionButton(\n            inputId = \"upload_decklist\",\n            label = \"Upload\"\n          )\n        ),\n        bslib::navset_card_tab(\n          bslib::nav_panel(\n            title = \"Decklist Stats\",\n          ),\n          bslib::nav_panel(\n            title = \"Simulate\",\n            bslib::layout_sidebar(\n              sidebar = bslib::sidebar(\n                width = 400,\n                shiny::numericInput(\n                  inputId = \"n_sim\",\n                  label = \"Number of Hands to Draw\",\n                  min = 1000,\n                  value = 1000,\n                  step = 1\n                ),\n                shiny::selectizeInput(\n                  inputId = \"fixed_cards\",\n                  label = bslib::tooltip(\n                    trigger = list(\n                      \"Select Fixed Card(s) for All Hands\",\n                      bsicons::bs_icon(\"info-circle\")\n                    ),\n                    \"Selected card(s) will be present in all simulated hands drawn\"\n                  ),\n                  choices = NULL,\n                  selected = NULL,\n                  multiple = TRUE,\n                  options = list(\n                    maxItems = 7\n                  )\n                ) |> \n                  shiny::tagAppendAttributes(class = \"fixed-cards\"),\n                shiny::actionButton(\n                  inputId = \"simulate_from_decklist\",\n                  label = \"Run Simulation\"\n                )\n              ),\n              bslib::card(\n                bslib::card_header(\"Simulation Results\"),\n                shiny::uiOutput(\"simulation_summary_from_decklist\")\n              )\n            )\n          ),\n          bslib::nav_panel(\n            title = \"Test Hand\",\n            bslib::layout_sidebar(\n              sidebar = bslib::sidebar(\n                width = 400,\n                shiny::actionButton(\n                  inputId = \"random_hand\",\n                  label = \"Draw Random Hand\"\n                ),\n                \"Cards in Hand:\",\n                shiny::selectInput(inputId = \"card1\", label = NULL, choices = NULL),\n                shiny::selectInput(inputId = \"card2\", label = NULL, choices = NULL),\n                shiny::selectInput(inputId = \"card3\", label = NULL, choices = NULL),\n                shiny::selectInput(inputId = \"card4\", label = NULL, choices = NULL),\n                shiny::selectInput(inputId = \"card5\", label = NULL, choices = NULL),\n                shiny::selectInput(inputId = \"card6\", label = NULL, choices = NULL),\n                shiny::selectInput(inputId = \"card7\", label = NULL, choices = NULL)\n              ),\n              bslib::card(\n                bslib::card_header(\"Your Hand\"),\n                bslib::layout_columns(\n                  col_widths = c(\n                    -2, 2, 2, 2, 2, -2, # 4 cards in row one\n                    -3, 2, 2, 2, -3   # 3 cards in row two\n                  ),\n                  shiny::uiOutput(\"image1\", inline = TRUE),\n                  shiny::uiOutput(\"image2\", inline = TRUE),\n                  shiny::uiOutput(\"image3\", inline = TRUE),\n                  shiny::uiOutput(\"image4\", inline = TRUE),\n                  shiny::uiOutput(\"image5\", inline = TRUE),\n                  shiny::uiOutput(\"image6\", inline = TRUE),\n                  shiny::uiOutput(\"image7\", inline = TRUE)\n                )\n              ),\n              shiny::uiOutput(\"test_hand_output\")\n            )\n          )\n        )\n      )\n    ),\n    bslib::nav_panel(\n      title = \"Group Counts\",\n    ),\n    bslib::nav_panel(\n      title = \"About\"\n    )\n  )\n)\n","type":"text"},{"name":"global.R","content":"\n# ---- Start of app_utils.R ----\n\nbold_percentage <- function(value) {\n  shiny::strong(scales::label_percent(accuracy = 0.01)(value))\n}\n\nrender_card <- function(decklist, input, card_index, card_height = 250) {\n  shiny::renderUI({\n    img_src <- decklist |>\n      dplyr::filter(card_name_scryfall == input[[glue::glue(\"card{ card_index }\")]]) |> \n      dplyr::pull(img_src)\n    \n    shiny::tags$img(\n      src = img_src,\n      alt = glue::glue(\"card{ card_index }\"),\n      crossorigin = \"anonymous\",\n      height = card_height\n    )\n  })\n}\n\n# ---- End of app_utils.R ----\n\n\n# ---- Start of hand_produces_1ub_T1.R ----\n\nhand_produces_1ub_T1 <- function(hand_metrics) {\n  if (hand_metrics$dark_ritual){\n    if (hand_metrics$lotus_petal){\n      if (hand_metrics$n_color_lands + hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      if (hand_metrics$mox_diamond & hand_metrics$n_lands >= 1) return(TRUE)\n      if (hand_metrics$chrome_mox & hand_metrics$n_cards_u + hand_metrics$n_cards_b >= 2) return(TRUE)\n    }\n    if (hand_metrics$chrome_mox){\n      if (hand_metrics$n_lands_b + hand_metrics$n_mdfc_lands_b >= 1){\n        if (hand_metrics$n_cards_u >= 1) return(TRUE)\n      }\n      if (hand_metrics$n_lands_u + hand_metrics$n_mdfc_lands_u >= 1){\n        if (hand_metrics$n_cards_b >= 2) return(TRUE)\n      }\n      if (hand_metrics$mox_diamond){\n        if (hand_metrics$n_lands >= 1 & hand_metrics$n_cards_u + hand_metrics$n_cards_b >= 2) return(TRUE)\n      }\n    }\n  }\n  \n  if (hand_metrics$lotus_petal){\n    if (hand_metrics$chrome_mox){\n      if (hand_metrics$n_lands >= 1 & hand_metrics$n_cards_b + hand_metrics$n_cards_u >= 1) return(TRUE)\n      if (hand_metrics$n_mdfc_lands >= 1 & hand_metrics$n_cards_b + hand_metrics$n_cards_u >= 2) return(TRUE)\n    }\n    if (hand_metrics$mox_diamond){\n      if (hand_metrics$n_lands >= 2) return(TRUE)\n      if (hand_metrics$n_lands == 1 & hand_metrics$mana_crypt) return(TRUE)\n    }\n  }\n  \n  if (hand_metrics$chrome_mox){\n    if (hand_metrics$n_lands >= 2){\n      if (hand_metrics$mox_diamond){\n        if (hand_metrics$n_cards_b + hand_metrics$n_cards_u >= 1) return(TRUE)\n      }\n      if (hand_metrics$mana_crypt){\n        if (hand_metrics$n_lands_b >= 1 & hand_metrics$n_cards_u >= 1) return(TRUE)\n        if (hand_metrics$n_lands_u >= 1 & hand_metrics$n_cards_b >= 1) return(TRUE)\n      }\n    }\n    if (hand_metrics$n_lands == 1){\n      if (hand_metrics$mox_diamond){\n        if (hand_metrics$n_mdfc_lands_b >= 1 & hand_metrics$n_cards_b + hand_metrics$n_cards_u >= 2) return(TRUE)\n        if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$n_cards_b + hand_metrics$n_cards_u >= 2) return(TRUE)\n        if (hand_metrics$mana_crypt & hand_metrics$n_cards_b + hand_metrics$n_cards_u >= 1) return(TRUE)\n      }\n      if (hand_metrics$mana_crypt){\n        if (hand_metrics$n_lands_b >= 1 & hand_metrics$n_cards_u >= 1) return(TRUE)\n        if (hand_metrics$n_lands_u >= 1 & hand_metrics$n_cards_b >= 1) return(TRUE)\n      }\n    }\n    if (hand_metrics$n_lands == 0){\n      if (hand_metrics$n_mdfc_lands >= 1){\n        if (hand_metrics$mana_crypt){\n          if (hand_metrics$n_mdfc_lands_b >= 1 & hand_metrics$n_cards_u >= 1) return(TRUE)\n          if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$n_cards_b >= 1) return(TRUE)\n        }\n      }\n    }\n  }\n  \n  if (hand_metrics$mana_crypt){\n    if (hand_metrics$lotus_petal){\n      if (hand_metrics$n_color_lands >= 1) return(TRUE)\n      if (hand_metrics$chrome_mox & hand_metrics$n_cards_b + hand_metrics$n_cards_u >= 1) return(TRUE)\n    }\n    if (hand_metrics$mox_diamond){\n      if (hand_metrics$n_lands >= 2 & hand_metrics$n_color_lands >= 1) return(TRUE)\n    }\n  }\n  \n  return(FALSE)\n}\n\n# ---- End of hand_produces_1ub_T1.R ----\n\n\n# ---- Start of hand_produces_ub_and_three_mana_T1.R ----\n\nhand_produces_ub_and_three_mana_T1 <- function(hand_metrics, constraint){\n  \n  if (constraint == \"U ON T1\"){\n    \n    n_lands_constraint_color     <- hand_metrics$n_lands_u\n    n_mdfc_lands_constraint_color <- hand_metrics$n_mdfc_lands_u\n    n_cards_constraint_color     <- hand_metrics$n_cards_u\n    \n    n_lands_other_color      <- hand_metrics$n_lands_b\n    n_mdfc_lands_other_color <- hand_metrics$n_mdfc_lands_b\n    n_cards_other_color      <- hand_metrics$n_cards_b\n    \n    \n  } else if (constraint == \"B ON T1\"){\n    \n    n_lands_constraint_color     <- hand_metrics$n_lands_b\n    n_mdfc_lands_constraint_color <- hand_metrics$n_mdfc_lands_b\n    n_cards_constraint_color     <- hand_metrics$n_cards_b\n    \n    n_lands_other_color      <- hand_metrics$n_lands_u\n    n_mdfc_lands_other_color <- hand_metrics$n_mdfc_lands_u\n    n_cards_other_color      <- hand_metrics$n_cards_u\n    \n  }\n  \n  if (hand_metrics$lotus_petal){\n    if (hand_metrics$chrome_mox){\n      if (n_cards_constraint_color >= 2){\n        if (hand_produces_ub(hand_metrics, use_lotus_petal = FALSE)) return(TRUE)\n      }\n      \n      if (n_cards_other_color >= 1){\n        if (hand_produces_ub_with_constraint(hand_metrics, constraint, use_lotus_petal = FALSE)) return(TRUE)\n      }\n      \n    }\n    \n    if (hand_metrics$mox_diamond){\n      if (hand_metrics$n_lands >= 2){\n        if (hand_metrics$n_color_lands >= 1) return(TRUE)\n        if (hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n      if (hand_metrics$n_lands == 1){\n        if (hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n    }\n  }\n  \n  if (hand_metrics$chrome_mox){\n    if (n_cards_constraint_color >= 2 | n_cards_other_color >= 1){\n      if (hand_metrics$mox_diamond){\n        if (hand_metrics$n_lands >= 2) return(TRUE)\n        if (hand_metrics$n_lands == 1 & hand_metrics$n_mdfc_lands >= 1) return(TRUE) \n      } \n    }\n  }\n  \n  if (hand_metrics$dark_ritual){\n    if (hand_produces_ub_and_two_mana_T1(hand_metrics, \"B ON T1\")) return(TRUE)\n  }\n\n  return(FALSE)\n}\n\n# ---- End of hand_produces_ub_and_three_mana_T1.R ----\n\n\n# ---- Start of hand_produces_ub_and_two_mana_T1.R ----\n\nhand_produces_ub_and_two_mana_T1 <- function(hand_metrics, constraint){\n  \n  if (constraint %in% c(\"U ON T1\", \"UU ON T1\")){\n    \n    n_lands_constraint_color     <- hand_metrics$n_lands_u\n    n_mdfc_lands_constraint_color <- hand_metrics$n_mdfc_lands_u\n    n_cards_constraint_color     <- hand_metrics$n_cards_u\n    \n    n_lands_other_color      <- hand_metrics$n_lands_b\n    n_mdfc_lands_other_color <- hand_metrics$n_mdfc_lands_b\n    n_cards_other_color      <- hand_metrics$n_cards_b\n    \n    \n  } else if (constraint %in% c(\"B ON T1\", \"BB ON T1\")){\n    \n    n_lands_constraint_color     <- hand_metrics$n_lands_b\n    n_mdfc_lands_constraint_color <- hand_metrics$n_mdfc_lands_b\n    n_cards_constraint_color     <- hand_metrics$n_cards_b\n    \n    n_lands_other_color      <- hand_metrics$n_lands_u\n    n_mdfc_lands_other_color <- hand_metrics$n_mdfc_lands_u\n    n_cards_other_color      <- hand_metrics$n_cards_u\n    \n  }\n  \n  if (hand_metrics$lotus_petal){\n    if (hand_produces_ub(hand_metrics, use_lotus_petal = FALSE)) return(TRUE)\n  }\n  \n  if (hand_metrics$chrome_mox){\n    if (n_cards_constraint_color >= 2){\n      if (hand_produces_ub(hand_metrics, use_lotus_petal = FALSE)) return(TRUE)\n    }\n    \n    if (n_cards_other_color >= 1 & !(constraint %in% c(\"UU ON T1\", \"BB ON T1\"))){\n      if (hand_produces_ub_with_constraint(hand_metrics, constraint, use_lotus_petal = FALSE)) return(TRUE)\n    }\n    \n  }\n\n  if (hand_metrics$mox_diamond){\n    if (hand_metrics$n_lands >= 2){\n      if (hand_metrics$n_color_lands >= 1) return(TRUE)\n      if (hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n    }\n    if (hand_metrics$n_lands == 1){\n      if (constraint %in% c(\"U ON T1\", \"B ON T1\")) {\n        if (hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n      if (constraint %in% c(\"UU ON T1\", \"BB ON T1\")) {\n        if (n_mdfc_lands_constraint_color >= 1) return(TRUE)\n      }\n    }\n  }\n  \n  return(FALSE)\n  \n}\n\n# ---- End of hand_produces_ub_and_two_mana_T1.R ----\n\n\n# ---- Start of hand_produces_ub_with_constraint.R ----\n\nhand_produces_ub_with_constraint <- function(hand_metrics, constraint, use_lotus_petal = TRUE, mdfc_enabler = FALSE){\n  if (constraint == \"U ON T1\"){\n    \n    n_lands_constraint_color     <- hand_metrics$n_lands_u\n    n_mdfc_lands_constraint_color <- hand_metrics$n_mdfc_lands_u\n    n_cards_constraint_color     <- hand_metrics$n_cards_u\n\n    n_lands_other_color      <- hand_metrics$n_lands_b\n    n_mdfc_lands_other_color <- hand_metrics$n_mdfc_lands_b\n    n_cards_other_color      <- hand_metrics$n_cards_b\n\n  } else if (constraint == \"B ON T1\"){\n    \n    n_lands_constraint_color     <- hand_metrics$n_lands_b\n    n_mdfc_lands_constraint_color <- hand_metrics$n_mdfc_lands_b\n    n_cards_constraint_color     <- hand_metrics$n_cards_b\n\n    n_lands_other_color      <- hand_metrics$n_lands_u\n    n_mdfc_lands_other_color <- hand_metrics$n_mdfc_lands_u\n    n_cards_other_color      <- hand_metrics$n_cards_u\n\n  }\n  \n  if (hand_metrics$n_lands >= 2){\n    \n    if (hand_metrics$n_color_lands >= 2){\n      if (hand_metrics$mox_diamond) return(TRUE)\n      if (use_lotus_petal & hand_metrics$lotus_petal){\n        if (n_lands_constraint_color     >= 1) return(TRUE)\n        if (n_mdfc_lands_constraint_color >= 1) return(TRUE)\n      }\n      if ((n_lands_constraint_color >= 1) & (n_lands_other_color >= 1)) return(TRUE)\n      if (n_lands_other_color == 0){\n        if (hand_metrics$chrome_mox & (n_cards_other_color >= 1)) return(TRUE)\n        if (n_mdfc_lands_other_color >= 1) return(TRUE)\n      }\n      if (n_lands_constraint_color == 0){\n        if (hand_metrics$chrome_mox & (n_cards_constraint_color >= 2)) return(TRUE)\n        if (n_mdfc_lands_constraint_color >= 1) return(TRUE)\n      }\n    }\n    \n    if (hand_metrics$n_color_lands == 1){\n      if (hand_metrics$mox_diamond) return(TRUE)\n      if (use_lotus_petal & hand_metrics$lotus_petal){\n        if (n_lands_constraint_color >= 1) return(TRUE)\n        if (n_mdfc_lands_constraint_color >= 1) return(TRUE)\n      }\n      if (n_lands_constraint_color == 1 & n_lands_other_color == 1 & hand_metrics$chrome_mox & (n_cards_constraint_color >= 2 | n_cards_other_color >= 1)) return(TRUE)\n      if (n_lands_constraint_color == 1 & n_lands_other_color == 1 & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      if (n_lands_other_color == 0){\n        if (hand_metrics$chrome_mox & n_cards_other_color >= 1) return(TRUE)\n        if (n_mdfc_lands_other_color >= 1) return(TRUE)\n      }\n      if (n_lands_constraint_color == 0){\n        if (hand_metrics$chrome_mox & n_cards_constraint_color >= 2) return(TRUE)\n        if (n_mdfc_lands_constraint_color >= 1) return(TRUE)\n      }\n    }\n    \n    if (hand_metrics$n_color_lands == 0){\n      if (hand_metrics$n_mdfc_lands == 0){\n        if (hand_metrics$mox_diamond & hand_metrics$chrome_mox & (n_cards_constraint_color >= 2 | n_cards_other_color >= 1)) return(TRUE)\n      }\n      if (hand_metrics$n_mdfc_lands == 1){\n        if (hand_metrics$mox_diamond) return(TRUE)\n        if (use_lotus_petal & hand_metrics$lotus_petal & n_mdfc_lands_constraint_color >= 1) return(TRUE)\n        if (n_mdfc_lands_constraint_color >= 1 & hand_metrics$chrome_mox & n_cards_other_color >= 1) return(TRUE)\n        if (n_mdfc_lands_other_color >= 1 & hand_metrics$chrome_mox & n_cards_constraint_color >= 2) return(TRUE)\n      }\n      if (hand_metrics$n_mdfc_lands == 2){\n        if (n_mdfc_lands_constraint_color >= 1 & n_mdfc_lands_other_color >= 1) return(TRUE)\n      }\n    }\n  }\n  \n  if (hand_metrics$n_lands == 1){\n\n    if (hand_metrics$n_color_lands == 1){\n      if (use_lotus_petal & hand_metrics$lotus_petal){\n        if (n_lands_constraint_color >= 1) return(TRUE)\n        if (n_mdfc_lands_constraint_color >= 1) return(TRUE)\n      }\n      if (!mdfc_enabler & n_lands_constraint_color == 1 & n_lands_other_color == 1 & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      if (mdfc_enabler & n_lands_constraint_color == 1 & n_lands_other_color == 1 & hand_metrics$n_mdfc_lands >= 2) return(TRUE)\n      if (n_lands_other_color == 1){\n        if (hand_metrics$chrome_mox & n_cards_constraint_color >= 2) return(TRUE)\n        if (!mdfc_enabler & n_mdfc_lands_constraint_color >= 1) return(TRUE)\n        if (mdfc_enabler & n_mdfc_lands_constraint_color >= 2) return(TRUE)\n        if (hand_metrics$mox_diamond & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n      if (n_lands_constraint_color == 1){\n        if (hand_metrics$chrome_mox & n_cards_other_color >= 1) return(TRUE)\n        if (n_mdfc_lands_other_color >= 1) return(TRUE)\n        if (hand_metrics$mox_diamond & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n    }\n    \n    if (hand_metrics$n_color_lands == 0){\n      if (n_mdfc_lands_constraint_color >= 1 & n_mdfc_lands_other_color >= 1) return(TRUE)\n      if (hand_metrics$mox_diamond){\n        if (hand_metrics$chrome_mox & (n_cards_constraint_color >= 2 | n_cards_other_color >= 1)) return(TRUE)\n        if (hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n      if (n_mdfc_lands_constraint_color >= 1 & hand_metrics$chrome_mox & n_cards_other_color >= 1) return(TRUE)\n      if (n_mdfc_lands_other_color >= 1 & hand_metrics$chrome_mox & n_cards_constraint_color >= 2) return(TRUE)\n      if (use_lotus_petal & hand_metrics$lotus_petal & n_mdfc_lands_constraint_color >= 1) return(TRUE)\n    }\n  }\n  \n  if (hand_metrics$n_lands == 0){\n    if (use_lotus_petal & hand_metrics$lotus_petal & hand_metrics$chrome_mox & (n_cards_constraint_color >= 2 | n_cards_other_color >= 1)) return(TRUE)\n    if (use_lotus_petal & hand_metrics$lotus_petal & n_mdfc_lands_constraint_color >= 1) return(TRUE)\n    if (n_mdfc_lands_constraint_color >= 1 & hand_metrics$chrome_mox & n_cards_other_color >= 1) return(TRUE)\n    if (n_mdfc_lands_other_color >= 1 & hand_metrics$chrome_mox & n_cards_constraint_color >= 2) return(TRUE)\n    if (n_mdfc_lands_constraint_color >= 1 & n_mdfc_lands_other_color >= 1) return(TRUE)\n  }\n  \n  return(FALSE)\n}\n\n# ---- End of hand_produces_ub_with_constraint.R ----\n\n\n# ---- Start of hand_produces_ub.R ----\n\nhand_produces_ub <- function(hand_metrics, use_lotus_petal = TRUE){\n  if (hand_metrics$n_lands >= 2){\n    \n    if (hand_metrics$n_color_lands >= 2){\n      if (hand_metrics$mox_diamond) return(TRUE)\n      if (use_lotus_petal & hand_metrics$lotus_petal) return(TRUE)\n      if ((hand_metrics$n_lands_u >= 1) & (hand_metrics$n_lands_b >= 1)) return(TRUE)\n      if (hand_metrics$n_lands_b == 0){\n        if (hand_metrics$chrome_mox & (hand_metrics$n_cards_b >= 1)) return(TRUE)\n        if (hand_metrics$n_mdfc_lands_b >= 1) return(TRUE)\n      }\n      if (hand_metrics$n_lands_u == 0){\n        if (hand_metrics$chrome_mox & (hand_metrics$n_cards_u >= 1)) return(TRUE)\n        if (hand_metrics$n_mdfc_lands_u >= 1) return(TRUE)\n      }\n    }\n    \n    if (hand_metrics$n_color_lands == 1){\n      if (hand_metrics$mox_diamond) return(TRUE)\n      if (use_lotus_petal & hand_metrics$lotus_petal) return(TRUE)\n      if (hand_metrics$n_lands_u == 1 & hand_metrics$n_lands_b == 1 & hand_metrics$chrome_mox & (hand_metrics$n_cards_u >= 1 | hand_metrics$n_cards_b >= 1)) return(TRUE)\n      if (hand_metrics$n_lands_u == 1 & hand_metrics$n_lands_b == 1 & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      if (hand_metrics$n_lands_b == 0){\n        if (hand_metrics$chrome_mox & hand_metrics$n_cards_b >= 1) return(TRUE)\n        if (hand_metrics$n_mdfc_lands_b >= 1) return(TRUE)\n      }\n      if (hand_metrics$n_lands_u == 0){\n        if (hand_metrics$chrome_mox & hand_metrics$n_cards_u >= 1) return(TRUE)\n        if (hand_metrics$n_mdfc_lands_u >= 1) return(TRUE)\n      }\n    }\n    \n    if (hand_metrics$n_color_lands == 0){\n      if (hand_metrics$n_mdfc_lands == 0){\n        if (hand_metrics$mox_diamond & hand_metrics$chrome_mox & (hand_metrics$n_cards_u >= 1 | hand_metrics$n_cards_b >= 1)) return(TRUE)\n      }\n      if (hand_metrics$n_mdfc_lands == 1){\n        if (hand_metrics$mox_diamond) return(TRUE)\n        if (use_lotus_petal & hand_metrics$lotus_petal) return(TRUE)\n        if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$chrome_mox & hand_metrics$n_cards_b >= 1) return(TRUE)\n        if (hand_metrics$n_mdfc_lands_b >= 1 & hand_metrics$chrome_mox & hand_metrics$n_cards_u >= 1) return(TRUE)\n      }\n      if (hand_metrics$n_mdfc_lands == 2){\n        if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$n_mdfc_lands_b >= 1) return(TRUE)\n      }\n    }\n  }\n  \n  if (hand_metrics$n_lands == 1){\n    \n    if (hand_metrics$n_color_lands == 1){\n      if (use_lotus_petal & hand_metrics$lotus_petal) return(TRUE)\n      if (hand_metrics$n_lands_u == 1 & hand_metrics$n_lands_b == 1 & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      if (hand_metrics$n_lands_b == 1){\n        if (hand_metrics$chrome_mox){\n          if (hand_metrics$n_cards_u >= 1) return(TRUE)\n          if (hand_metrics$n_cards_b >= 1 & hand_metrics$mox_diamond) return(TRUE)\n        }\n        \n        if (hand_metrics$n_mdfc_lands_u >= 1) return(TRUE)\n        if (hand_metrics$mox_diamond & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n      if (hand_metrics$n_lands_u == 1){\n        if (hand_metrics$chrome_mox){\n          if (hand_metrics$n_cards_b >= 1) return(TRUE)\n          if (hand_metrics$n_cards_u >= 1 & hand_metrics$mox_diamond) return(TRUE)\n        }\n        \n        if (hand_metrics$n_mdfc_lands_b >= 1) return(TRUE)\n        if (hand_metrics$mox_diamond & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n    }\n    \n    if (hand_metrics$n_color_lands == 0){\n      if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$n_mdfc_lands_b >= 1) return(TRUE)\n      if (hand_metrics$mox_diamond){\n        if (hand_metrics$chrome_mox & (hand_metrics$n_cards_u >= 1 | hand_metrics$n_cards_b >= 1)) return(TRUE)\n        if (hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n      }\n      if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$chrome_mox & hand_metrics$n_cards_b >= 1) return(TRUE)\n      if (hand_metrics$n_mdfc_lands_b >= 1 & hand_metrics$chrome_mox & hand_metrics$n_cards_u >= 1) return(TRUE)\n      if (use_lotus_petal & hand_metrics$lotus_petal & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n    }\n  }\n  \n  if (hand_metrics$n_lands == 0){\n    if (use_lotus_petal & hand_metrics$lotus_petal & hand_metrics$chrome_mox & (hand_metrics$n_cards_u >= 1 | hand_metrics$n_cards_b >= 1)) return(TRUE)\n    if (use_lotus_petal & hand_metrics$lotus_petal & hand_metrics$n_mdfc_lands >= 1) return(TRUE)\n    if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$chrome_mox & hand_metrics$n_cards_b >= 1) return(TRUE)\n    if (hand_metrics$n_mdfc_lands_b >= 1 & hand_metrics$chrome_mox & hand_metrics$n_cards_u >= 1) return(TRUE)\n    if (hand_metrics$n_mdfc_lands_u >= 1 & hand_metrics$n_mdfc_lands_b >= 1) return(TRUE)\n  }\n  \n  return(FALSE)\n}\n\n# ---- End of hand_produces_ub.R ----\n\n\n# ---- Start of is_yuriko_on_T2.R ----\n\n#' @export\nis_yuriko_on_T2 <- function(opening_hand){\n\n  # TODO: Add parameter to indicate whether we are playing first\n  # TODO: Add logic to account for Gemstone Caverns when we are not playing first\n\n  hand_metrics <- summarise_hand(opening_hand)\n\n  if (hand_metrics$n_enablers >= 1){\n    \n    # ENABLER 0 ####\n    if (hand_metrics$n_enablers_0 >= 1){\n      if (hand_produces_ub(hand_metrics)) return(TRUE)\n    }\n    \n    # ENABLER 1 ####\n    if (hand_metrics$n_enablers_1 >= 1){\n      \n      # > COLORLESS ####\n      if (hand_metrics$n_enablers_c >= 1){\n        if (hand_produces_ub(hand_metrics)) return(TRUE)\n      }\n      \n      # > BLUE ####\n      if (hand_metrics$n_enablers_u >= 1){\n        if (hand_produces_ub_with_constraint(hand_metrics, \"U ON T1\")) return(TRUE)\n      }\n      \n      # > BLACK ####\n      if (hand_metrics$n_enablers_b >= 1){\n        if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\")) return(TRUE)\n      }\n      \n    }\n    \n    # ENABLER 2 ####\n    if (hand_metrics$n_enablers_2 >= 1){\n      \n      # > 1U ####\n      if (hand_metrics$n_enablers_1u >= 1){\n        if (hand_metrics$mana_crypt){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"U ON T1\")) return(TRUE)\n        }\n        \n        if (hand_produces_ub_and_two_mana_T1(hand_metrics, \"U ON T1\")) return(TRUE)\n        \n      }\n      \n      # > 1B ####\n      if (hand_metrics$n_enablers_1b >= 1){\n        if (hand_metrics$mana_crypt){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\")) return(TRUE)\n        }\n        \n        if (hand_produces_ub_and_two_mana_T1(hand_metrics, \"B ON T1\")) return(TRUE)\n        \n        if (hand_metrics$dark_ritual){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\")) return(TRUE)\n        }\n      }\n      \n      # > UU ####\n      if (hand_metrics$n_enablers_uu >= 1){\n        if (hand_produces_ub_and_two_mana_T1(hand_metrics, \"UU ON T1\")) return(TRUE)\n      }\n      \n      # > BB ####\n      if (hand_metrics$n_enablers_bb >= 1){\n        if (hand_produces_ub_and_two_mana_T1(hand_metrics, \"BB ON T1\")) return(TRUE)\n        \n        if (hand_metrics$dark_ritual){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\")) return(TRUE)\n        }\n      }\n      \n      # > UB ####\n      if (hand_metrics$n_enablers_ub >= 1){\n        if (\n          hand_produces_ub_and_two_mana_T1(hand_metrics, \"B ON T1\") |\n          hand_produces_ub_and_two_mana_T1(hand_metrics, \"U ON T1\")\n          ) return(TRUE)\n      }\n      \n      \n    }\n    # ENABLER 3 ####\n    if (hand_metrics$n_enablers_3 >= 1){\n      \n      # > 2U ####\n      if (hand_metrics$n_enablers_2u >= 1){\n        if (hand_metrics$mana_crypt){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"U ON T1\")) return(TRUE)\n        }\n        \n        if(hand_produces_ub_and_three_mana_T1(hand_metrics, \"U ON T1\")) return(TRUE)\n        \n        \n      }\n      \n      # > MDFC 2U ####\n      if (hand_metrics$n_mdfc_enablers_2u >= 1){\n        if (hand_metrics$mana_crypt){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"U ON T1\", mdfc_enabler = TRUE)) return(TRUE)\n        }\n        \n        if(hand_produces_ub_and_three_mana_T1(hand_metrics, \"U ON T1\")) return(TRUE)\n        \n        \n      }\n      \n      # > 2B ####\n      if (hand_metrics$n_enablers_2b >= 1){\n        \n        if (hand_metrics$mana_crypt){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\")) return(TRUE)\n        }\n        \n        if (hand_metrics$dark_ritual){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\")) return(TRUE)\n        }\n        \n        if(hand_produces_ub_and_three_mana_T1(hand_metrics, \"B ON T1\")) return(TRUE)\n        \n      }\n      \n      # > MDFC 2B ####\n      if (hand_metrics$n_mdfc_enablers_2b >= 1){\n        if (hand_metrics$mana_crypt){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\", mdfc_enabler = TRUE)) return(TRUE)\n        }\n        \n        if (hand_metrics$dark_ritual){\n          if (hand_produces_ub_with_constraint(hand_metrics, \"B ON T1\")) return(TRUE)\n        }\n        \n        if(hand_produces_ub_and_three_mana_T1(hand_metrics, \"B ON T1\")) return(TRUE)\n        \n      }\n\n    }\n  }\n\n  # YURIKO T1 ####\n  if (hand_produces_1ub_T1(hand_metrics)) return(TRUE)\n\n  return(FALSE)\n}\n\n# ---- End of is_yuriko_on_T2.R ----\n\n\n# ---- Start of process_card_data.R ----\n\n#' @export\nprocess_card_data <- function(decklist_source, source_path, use_httr) {\n  parse_decklist(decklist_source, source_path, use_httr) |> \n    add_scryfall_data(use_httr) |> \n    add_custom_attributes()\n}\n\nparse_decklist <- function(decklist_source, source_path, use_httr) {\n  \n  if (decklist_source == \"moxfield_url\") {\n\n    url <- source_path |> \n      stringr::str_replace(\"https://www.moxfield.com/decks\", \"https://api.moxfield.com/v2/decks/all\")\n    \n    if (use_httr) {\n      \n      moxfield_json <- url |> \n        jsonlite::fromJSON(flatten = TRUE)\n      \n    } else {\n      \n      # httr does not work with shinylive\n      temp_json <- tempfile(fileext = \".json\")\n\n      # Download the JSON file\n      download.file(url, temp_json)\n      \n      # Parse JSON content\n      moxfield_json <- temp_json |> \n        jsonlite::fromJSON(flatten = TRUE)\n      \n    }\n    \n    tibble::tibble(\n      card_name_source = names(moxfield_json$mainboard) |> sort()\n    )\n    \n  } else if (decklist_source == \"file\") {\n    \n    # Read cards into a character vector\n    cards <- readLines(source_path, warn = FALSE)\n    \n    # TODO: Error handler when the file is not structured correctly\n    \n    # Find the index of the last card in the main deck\n    index_last_card_in_main_deck <- which(cards == \"\")[[1]] - 1\n    \n    # Remove all cards that are not part of the main deck\n    cards <- cards[seq_len(index_last_card_in_main_deck)]\n    \n    cards_as_tibble <- cards |> \n      # Convert to tibble\n      tibble::tibble() |> \n      # Separate into n_cards and card_name columns\n      tidyr::separate(\n        col = \"cards\",\n        into = c(\"n_cards\", \"card_name_source\"),\n        sep = \" \",\n        extra = \"merge\",\n        convert = TRUE\n      )\n\n  }\n  \n}\n\nadd_scryfall_data <- function(card_data, use_httr) {\n\n  # Initialize an empty list to store the data\n  scryfall_data <- list()\n\n  # Extract card names from the input data\n  card_names <- card_data |>\n    dplyr::pull(card_name_source)\n\n  # Initialize progress bar\n  cli::cli_progress_bar(\"Processing Decklist...\", total = nrow(card_data), format = paste0(\"ETA:{cli::pb_eta}\"))\n  \n  # Iterate over each card\n  for (card_index in seq_along(card_names)) {\n    card_name_source <- card_names[card_index]\n\n    # Wait between requests to the API\n    Sys.sleep(0.1)\n\n    if (use_httr) {\n\n      # API endpoint and query parameters\n      url <- \"https://api.scryfall.com/cards/named\"\n      query_params <- list(exact = card_name_source)\n\n      # Make GET request to Scryfall API\n      response <- httr::GET(url, query = query_params)\n\n      # Parse JSON content\n      card_info <- response |>\n        httr::content(as = \"text\") |> \n        jsonlite::fromJSON(flatten = TRUE)\n      \n    } else {\n\n      # httr does not work with shinylive\n      temp_card_json <- tempfile(pattern = \"card\", fileext = \".json\")\n\n      # Format card name for URL\n      card_name_for_url <- card_name_source |> \n        stringr::str_replace_all(\" \", \"%20\") |> \n        stringr::str_replace_all(\"/\", \"%20\")\n\n      url <- glue::glue(\"https://api.scryfall.com/cards/named?exact={ card_name_for_url }\")\n\n      # Download the JSON file\n      download.file(url, temp_card_json)\n\n      # Parse JSON content\n      card_info <- temp_card_json |> \n        jsonlite::fromJSON(flatten = TRUE)\n\n    }\n\n    # Process card data based on layout type\n    if (card_info$layout %in% c(\"split\", \"flip\", \"adventure\", \"normal\")) {\n      card_index_scryfall_data <- tibble::tibble(\n        card_name_source = card_name_source,\n        layout = card_info$layout,\n        card_name_scryfall = card_info$name,\n        cmc = card_info$cmc,\n        mana_cost = card_info$mana_cost,\n        type = card_info$type_line,\n        produced_mana = paste0(card_info$produced_mana, collapse = \"\"),\n        img_src = card_info$image_uris$png\n      )\n    }\n\n    if (card_info$layout %in% c(\"transform\")) {\n      card_index_scryfall_data <- tibble::tibble(\n        card_name_source = card_name_source,\n        layout = card_info$layout,\n        card_name_scryfall = card_info$name,\n        cmc = card_info$cmc,\n        mana_cost = paste0(card_info$card_faces$mana_cost[[1]], collapse = \"\"),\n        type = card_info$type_line,\n        produced_mana = paste0(card_info$produced_mana, collapse = \"\"),\n        img_src = card_info$card_faces$image_uris.png[[1]]\n      )\n    }\n\n    if (card_info$layout == \"modal_dfc\") {\n      card_index_scryfall_data <- tibble::tibble(\n        card_name_source = card_name_source,\n        layout = card_info$layout,\n        card_name_scryfall = card_info$name,\n        cmc = card_info$cmc,\n        mana_cost = paste0(card_info$card_faces$mana_cost, collapse = \" // \"),\n        type = paste0(card_info$card_faces$type_line, collapse = \" // \"),\n        produced_mana = paste0(card_info$produced_mana, collapse = \"\"),\n        img_src = card_info$card_faces$image_uris.png[[1]]\n      )\n    }\n\n    # TODO: add logic for \"prototype\" layout\n\n    # Add the processed card data to the list\n    scryfall_data[[card_index]] <- card_index_scryfall_data\n\n    # Update the progress bar\n    cli::cli_progress_update()\n\n  }\n\n  # Combine all individual card dataframes into one\n  scryfall_data <- dplyr::bind_rows(scryfall_data)\n\n  # Mark progress as complete\n  cli::cli_progress_done()\n\n  return(scryfall_data)\n\n}\n\nadd_custom_attributes <- function(card_data) {\n\n  card_data |>\n    edit_scryfall_data() |> \n    dplyr::mutate(\n\n      enabler = is_enabler(cmc, type),\n\n      # Enabler cmc\n      enabler_0 = is_enabler_0(enabler, mana_cost),\n      enabler_1 = is_enabler_1(enabler, cmc, mana_cost),      \n      enabler_2 = is_enabler_2(enabler, cmc),\n      enabler_3 = is_enabler_3(enabler, cmc),\n\n      # Enabler mana cost (non-mdfc)\n      enabler_c = is_enabler_c(enabler_1, mana_cost),\n      enabler_u = is_enabler_u(enabler_1, mana_cost),\n      enabler_b = is_enabler_b(enabler_1, mana_cost),\n\n      enabler_1u = is_enabler_1u(enabler_2, mana_cost),\n      enabler_1b = is_enabler_1b(enabler_2, mana_cost),\n      enabler_uu = is_enabler_uu(enabler_2, mana_cost),\n      enabler_bb = is_enabler_bb(enabler_2, mana_cost),\n      enabler_ub = is_enabler_ub(enabler_2, mana_cost),\n\n      enabler_2u = is_enabler_2u(layout, enabler_3, mana_cost),\n      enabler_2b = is_enabler_2b(layout, enabler_3, mana_cost),\n\n      # Enabler mana cost (mdfc)\n      mdfc_enabler_2u = is_mdfc_enabler_2u(layout, enabler_3, mana_cost),\n      mdfc_enabler_2b = is_mdfc_enabler_2b(layout, enabler_3, mana_cost),\n\n      # Card color\n      color_u = is_color_u(mana_cost),\n      color_b = is_color_b(mana_cost),\n\n      # Lands (non-mdfc)\n      land = is_land(type),\n      color_land = is_color_land(land, produced_mana),\n      land_u = is_land_u(color_land, produced_mana),\n      land_b = is_land_b(color_land, produced_mana),\n\n      # Lands (mdfc)\n      mdfc_land = is_mdfc_land(layout, type),\n      mdfc_land_u = is_mdfc_land_u(mdfc_land, produced_mana),\n      mdfc_land_b = is_mdfc_land_b(mdfc_land, produced_mana),\n\n      # Cards that require additional logic\n      chrome_mox = card_name_scryfall == \"Chrome Mox\",\n      dark_ritual = card_name_scryfall == \"Dark Ritual\",\n      lotus_petal = card_name_scryfall == \"Lotus Petal\",\n      mana_crypt = card_name_scryfall == \"Mana Crypt\",\n      mox_diamond = card_name_scryfall == \"Mox Diamond\"\n\n    )\n}\n\nedit_scryfall_data <- function(card_data) {\n\n  # For simplicity, we assume that we are playing first\n  # which means Gemstone Caverns produces only colorless mana\n  if (\"Gemstone Caverns\" %in% card_data$card_name_scryfall) {\n    card_data <- card_data |> \n      dplyr::mutate(\n        produced_mana = ifelse(\n          test = card_name_scryfall == \"Gemstone Caverns\",\n          yes = \"C\",\n          no = produced_mana\n        )\n      )\n  }\n  \n  # With Demonic Tutor we can tutor an Enabler with MV = 0\n  # So we can consider Demonic Tutor as an Enabler that costs 1B\n  # (for which logic was already defined)\n  if (\"Demonic Tutor\" %in% card_data$card_name_scryfall) {\n    card_data <- card_data |> \n      dplyr::mutate(\n        type = ifelse(\n          test = card_name_scryfall == \"Demonic Tutor\",\n          yes = \"Creature // Sorcery\",\n          no = type\n        )\n      )\n  }\n  \n  card_data\n\n}\n\n# ---- End of process_card_data.R ----\n\n\n# ---- Start of run_simulation.R ----\n\n#' @export\nrun_simulation <- function(decklist, fixed_cards = NULL, seed = 2611, n_sim) {\n  # Set seet for reproducibility\n  set.seed(seed)\n  \n  # Initialize count of yuriko triggers on turn two\n  n_yuriko_triggers_on_turn_two <- 0\n  \n  # Initialize progress bar\n  cli::cli_progress_bar(\"Running Simulation...\", total = n_sim, format = paste0(\"ETA:{cli::pb_eta}\"))\n  \n  # Simulate...\n  for (i in 1:n_sim) {\n    \n    hand <- draw_seven(decklist, fixed_cards)\n    \n    if (is_yuriko_on_T2(hand)) n_yuriko_triggers_on_turn_two = n_yuriko_triggers_on_turn_two + 1\n    \n    cli::cli_progress_update()\n    \n  }\n  \n  cli::cli_progress_done()\n\n  prob_yuriko_triggers_on_turn_two <- n_yuriko_triggers_on_turn_two / n_sim\n  \n  return(prob_yuriko_triggers_on_turn_two)\n  \n}\n\n# ---- End of run_simulation.R ----\n\n\n# ---- Start of summarise_hand.R ----\n\nsummarise_hand <- function(opening_hand){\n  list(\n    \"n_lands\"        = opening_hand$land        |> sum(),\n    \"n_color_lands\"  = opening_hand$color_land  |> sum(),\n    \"n_lands_u\"      = opening_hand$land_u      |> sum(),\n    \"n_lands_b\"      = opening_hand$land_b      |> sum(),\n    \"n_mdfc_lands\"   = opening_hand$mdfc_land   |> sum(),\n    \"n_mdfc_lands_u\" = opening_hand$mdfc_land_u |> sum(),\n    \"n_mdfc_lands_b\" = opening_hand$mdfc_land_b |> sum(),\n    \n    \"n_enablers\"   = opening_hand$enabler   |> sum(),\n    \"n_enablers_0\" = opening_hand$enabler_0 |> sum(),\n    \"n_enablers_1\" = opening_hand$enabler_1 |> sum(),\n    \"n_enablers_2\" = opening_hand$enabler_2 |> sum(),\n    \"n_enablers_3\" = opening_hand$enabler_3 |> sum(),\n\n    \"n_enablers_c\" = opening_hand$enabler_c |> sum(),\n    \"n_enablers_u\" = opening_hand$enabler_u |> sum(),\n    \"n_enablers_b\" = opening_hand$enabler_b |> sum(),\n\n    \"n_enablers_1u\" = opening_hand$enabler_1u |> sum(),\n    \"n_enablers_1b\" = opening_hand$enabler_1b |> sum(),\n    \"n_enablers_uu\" = opening_hand$enabler_uu |> sum(),\n    \"n_enablers_bb\" = opening_hand$enabler_bb |> sum(),\n    \"n_enablers_ub\" = opening_hand$enabler_ub |> sum(),\n    \n    \"n_enablers_2u\" = opening_hand$enabler_2u |> sum(),\n    \"n_enablers_2b\" = opening_hand$enabler_2b |> sum(),\n    \n    \"n_mdfc_enablers_2u\" = opening_hand$mdfc_enabler_2u |> sum(),\n    \"n_mdfc_enablers_2b\" = opening_hand$mdfc_enabler_2b |> sum(),\n\n    \"n_cards_u\" = opening_hand$color_u |> sum(),\n    \"n_cards_b\" = opening_hand$color_b |> sum(),\n\n    \"chrome_mox\"  = opening_hand$chrome_mox  |> sum(),\n    \"dark_ritual\" = opening_hand$dark_ritual |> sum(),\n    \"lotus_petal\" = opening_hand$lotus_petal |> sum(),\n    \"mana_crypt\"  = opening_hand$mana_crypt  |> sum(),\n    \"mox_diamond\" = opening_hand$mox_diamond |> sum()\n  )\n}\n\n# ---- End of summarise_hand.R ----\n\n\n# ---- Start of utils-add_custom_attributes.R ----\n\n# ENABLERS ####\n\n# TODO: add logic for enablers that use phyrexian mana\n\nis_enabler <- function(cmc, type) {\n  cmc <= 3 & grepl(\"Creature\", type)\n}\n\n# > CMC = 0 ####\nis_enabler_0 <- function(is_enabler, mana_cost) {\n  is_enabler & mana_cost == \"{0}\"\n}\n\n# > CMC = 1 ####\nis_enabler_1 <- function(is_enabler, cmc, mana_cost) {\n  is_enabler & (cmc == 1 | mana_cost == \"{X}\")\n}\n\nis_enabler_c <- function(is_enabler_1, mana_cost) {\n  is_enabler_1 & mana_cost %in% c(\"{1}\", \"{X}\")\n}\n\nis_enabler_u <- function(is_enabler_1, mana_cost) {\n  is_enabler_1 & grepl(\"{U}\", mana_cost, fixed = TRUE)\n}\n\nis_enabler_b <- function(is_enabler_1, mana_cost) {\n  is_enabler_1 & grepl(\"{B}\", mana_cost, fixed = TRUE)\n}\n\n# > CMC = 2 ####\nis_enabler_2 <- function(is_enabler, cmc) {\n  is_enabler & cmc == 2\n}\n\nis_enabler_1u <- function(is_enabler_2, mana_cost) {\n  is_enabler_2 & grepl(\"{1}{U}\", mana_cost, fixed = TRUE)\n}\n\nis_enabler_1b <- function(is_enabler_2, mana_cost) {\n  is_enabler_2 & grepl(\"{1}{B}\", mana_cost, fixed = TRUE)\n}\n\nis_enabler_uu <- function(is_enabler_2, mana_cost) {\n  is_enabler_2 & grepl(\"{U}{U}\", mana_cost, fixed = TRUE)\n}\n\nis_enabler_bb <- function(is_enabler_2, mana_cost) {\n  is_enabler_2 & grepl(\"{B}{B}\", mana_cost, fixed = TRUE)\n}\n\nis_enabler_ub <- function(is_enabler_2, mana_cost) {\n  is_enabler_2 & grepl(\"{U}{B}\", mana_cost, fixed = TRUE)\n}\n\n# > CMC = 3 ####\nis_enabler_3 <- function(is_enabler, cmc) {\n  is_enabler & cmc == 3\n}\n\nis_enabler_2u <- function(layout, is_enabler_3, mana_cost) {\n  layout != \"modal_dfc\" & is_enabler_3 & grepl(\"{2}{U}\", mana_cost, fixed = TRUE)\n}\n\nis_enabler_2b <- function(layout, is_enabler_3, mana_cost) {\n  layout != \"modal_dfc\" & is_enabler_3 & grepl(\"{2}{B}\", mana_cost, fixed = TRUE)\n}\n\nis_mdfc_enabler_2u <- function(layout, is_enabler_3, mana_cost) {\n  layout == \"modal_dfc\" & is_enabler_3 & grepl(\"{2}{U}\", mana_cost, fixed = TRUE)\n}\n\nis_mdfc_enabler_2b <- function(layout, is_enabler_3, mana_cost) {\n  layout == \"modal_dfc\" & is_enabler_3 & grepl(\"{2}{B}\", mana_cost, fixed = TRUE)\n}\n\n# COLOR IDENTITY ####\nis_color_u <- function(mana_cost) {\n  grepl(\"U\", mana_cost)\n}\n\nis_color_b <- function(mana_cost) {\n  grepl(\"B\", mana_cost)\n}\n\n# LANDS ####\nis_land <- function(type) {\n  # mdfc cards that have a land in both card faces are included\n  grepl(\"Land\", type) & !grepl(\"(Creature)|(Instant)|(Sorcery)\", type)\n}\n\nis_color_land <- function(is_land, produced_mana) {\n  # Even though Fetchlands don't produce mana, they are considered color lands\n  is_land & (grepl(\"U|B\", produced_mana) | produced_mana == \"\")\n}\n\nis_land_u <- function(is_color_land, produced_mana) {\n  is_color_land & (grepl(\"U\", produced_mana) | produced_mana == \"\")\n}\n\nis_land_b <- function(is_color_land, produced_mana) {\n  is_color_land & (grepl(\"B\", produced_mana) | produced_mana == \"\")\n}\n\n# MDFC LANDS ####\nis_mdfc_land <- function(layout, type) {\n  # mdfc cards that have a land in both card faces are excluded\n  layout == \"modal_dfc\" & grepl(\"Land\", type) & grepl(\"(Creature)|(Instant)|(Sorcery)\", type)\n}\n\nis_mdfc_land_u <- function(is_mdfc_land, produced_mana) {\n  is_mdfc_land & grepl(\"U\", produced_mana)\n}\n\nis_mdfc_land_b <- function(is_mdfc_land, produced_mana) {\n  is_mdfc_land & grepl(\"B\", produced_mana)\n}\n\n# ---- End of utils-add_custom_attributes.R ----\n\n\n# ---- Start of utils.R ----\n\n#' @export\ndraw_seven <- function(decklist, fixed_cards = NULL){\n  if (is.null(fixed_cards)) {\n\n    decklist |>\n      dplyr::slice_sample(n = 7)\n\n  } else {\n    n_fixed_cards <- length(fixed_cards)\n    \n    hand <- decklist |>\n      dplyr::filter(!card_name_scryfall %in% fixed_cards) |>\n      dplyr::slice_sample(n = 7 - n_fixed_cards)\n    \n    hand |>\n      dplyr::bind_rows(decklist |> dplyr::filter(card_name_scryfall %in% fixed_cards))\n  }\n\n}\n\n#' @export\nget_hand <- function(decklist, cards){\n  decklist |>\n    dplyr::filter(card_name_scryfall %in% cards)\n}\n\n# ---- End of utils.R ----\n\n\n","type":"text"},{"name":"www/styles.css","content":".fixed-cards .selectize-input {\n  display: grid;\n}\n","type":"text"}]
